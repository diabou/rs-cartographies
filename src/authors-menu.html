<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/web-animations-js/web-animations-next.min.html"/>
<link rel="import" href="query-manager.html"/>

<dom-module id="authors-menu">
  <template>
    <style>
      .author {
        cursor: pointer;
      }

      paper-dropdown-menu {
        --paper-dropdown-menu-label: {
          color: white;
        };

        --paper-dropdown-menu-input: {
          color: white;
        };
      }
    </style>

    <query-manager
        id="query"
        params='{"fl":"authFullName_s"}'
        on-response=_makeAuthorsList>
    </query-manager>

    <paper-dropdown-menu label="Chose Author">
      <paper-listbox slot="dropdown-content" selected-item={{_selectedItem}}>
        <template is="dom-repeat" items=[[_sortedNames]]>
          <paper-item class="author">[[item]]</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

  </template>

  <script>
      /**
       * @customElement
       * @polymer
       */
      class AuthorsMenu extends Polymer.Element {
          static get is() {
              return 'authors-menu';
          }

          static get properties() {
              return {
                  /**
                   * List of author names (as Strings).
                   */
                  _sortedNames: {
                      type: Array,
                      value: () => []
                  },

                  /**
                   * HTML element containing the name of the currently selected author.
                   */
                  _selectedItem: {
                      type: Object,
                      notify: true,
                      observer: '_setSelected',
                      value: null
                  },

                  /**
                   * Name of the currently selected author.
                   */
                  selected: {
                      type: String,
                      notify: true,
                      reflectOnAttribute: true,
                      value: null
                  }
              };
          }

          ready() {
              super.ready();
              this.$.query.fetchAsJSON();
          }

          _setSelected(item) {
              if (item) {
                  this.set('selected', item.innerHTML);
              }
          }

          _makeAuthorsList(e) {
              this.set(
                  '_sortedNames',
                  Array.prototype.concat.apply([], e.detail.body.map(doc => doc.authFullName_s))
              );
          }
      }

      window.customElements.define(AuthorsMenu.is, AuthorsMenu);
  </script>
</dom-module>