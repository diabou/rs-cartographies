<dom-module id="collaborators-network">

  <script>
      (function() {

          let memorizedTemplate;

          /**
           * @customElement
           * @polymer
           */
          class CollaboratorsNetwork extends RsCartoChart {
              static get is() {
                  return 'collaborators-network';
              }

              static get template() {
                  if (!memorizedTemplate) {
                      memorizedTemplate = RsCartoChart.template.cloneNode(true);

                      const svg = memorizedTemplate.content.getElementById('chart');
                      const canvas = document.createElement('canvas');
                      canvas.id = 'chart';
                      svg.parentNode.replaceChild(canvas, svg);

                      this.fillInTemplate(memorizedTemplate, '{"fl":"authFullName_s,halId_s,title_s"}', 'Collaborators');
                  }
                  return memorizedTemplate;
              }

              _formatData(body) {
                  const collaborators = [];

                  let collaborator,
                      publication;

                  body.forEach(doc => {
                      publication = {title: doc.title_s, haliId: doc.halId_s};
                      doc.authFullName_s
                          .filter(auth => auth !== this.authorName)
                          .forEach(auth => {
                              if (collaborator = collaborators.find(col => col.name === auth)) {
                                  collaborator.publications.push(publication);
                              } else {
                                  collaborators.push({name: auth, publications: [publication]});
                              }
                          });
                  });

                  this.set('_data', collaborators);
              }

              _generateChart() {

              }
          }

          window.customElements.define(CollaboratorsNetwork.is, CollaboratorsNetwork);

      })();
  </script>
</dom-module>